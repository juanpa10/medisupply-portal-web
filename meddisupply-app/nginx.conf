server {
  listen 80;
  server_name _;

  root /usr/share/nginx/html;
  index index.html;

  # Angular SPA
  location / {
    try_files $uri $uri/ /index.html;
  }

  # Static assets cache (evita cachear index.html)
  location ~* \.(?:css|js|png|jpg|jpeg|gif|ico|svg|woff2?)$ {
    expires 30d;
    add_header Cache-Control "public";
    try_files $uri =404;
  }

  # --------- PROXIES EQUIVALENTES A TU proxy.conf PROD ---------

  # /api/v1/managers -> http://52.55.197.150/managers
  location /api/v1/managers/ {
    proxy_pass http://52.55.197.150/managers/;
    include /etc/nginx/proxy_params;
  }
  location = /api/v1/managers {
    proxy_pass http://52.55.197.150/managers;
    include /etc/nginx/proxy_params;
  }

  # /api/v1/clients -> http://52.55.197.150/managers
  location /api/v1/clients/ {
    proxy_pass http://52.55.197.150/managers/;
    include /etc/nginx/proxy_params;
  }
  location = /api/v1/clients {
    proxy_pass http://52.55.197.150/managers;
    include /etc/nginx/proxy_params;
  }

  # /api/v1/clients-with-manager -> http://52.55.197.150/managers
  location /api/v1/clients-with-manager/ {
    proxy_pass http://52.55.197.150/managers/;
    include /etc/nginx/proxy_params;
  }
  location = /api/v1/clients-with-manager {
    proxy_pass http://52.55.197.150/managers;
    include /etc/nginx/proxy_params;
  }

  # /api/v1/suppliers -> http://52.55.197.150/crm
  location /api/v1/suppliers/ {
    proxy_pass http://52.55.197.150/crm/;
    include /etc/nginx/proxy_params;
  }
  location = /api/v1/suppliers {
    proxy_pass http://52.55.197.150/crm;
    include /etc/nginx/proxy_params;
  }

  # /api/v1/inventory -> http://52.55.197.150/inventory
  location /api/v1/inventory/ {
    proxy_pass http://52.55.197.150/inventory/;
    include /etc/nginx/proxy_params;
  }
  location = /api/v1/inventory {
    proxy_pass http://52.55.197.150/inventory;
    include /etc/nginx/proxy_params;
  }

  # /api/users-with-roles -> http://52.55.197.150/roles
  location /api/users-with-roles/ {
    proxy_pass http://52.55.197.150/roles/;
    include /etc/nginx/proxy_params;
  }
  location = /api/users-with-roles {
    proxy_pass http://52.55.197.150/roles;
    include /etc/nginx/proxy_params;
  }

  # /api/users -> http://52.55.197.150/roles
  location /api/users/ {
    proxy_pass http://52.55.197.150/roles/;
    include /etc/nginx/proxy_params;
  }
  location = /api/users {
    proxy_pass http://52.55.197.150/roles;
    include /etc/nginx/proxy_params;
  }

  # /auth y /auth/login -> http://52.55.197.150 (mantener el path original)
  location /auth/ {
    proxy_pass http://52.55.197.150;
    include /etc/nginx/proxy_params;
  }
  location = /auth {
    proxy_pass http://52.55.197.150;
    include /etc/nginx/proxy_params;
  }
  location = /auth/login {
    proxy_pass http://52.55.197.150;
    include /etc/nginx/proxy_params;
  }

  # Healthcheck
  location = /healthz {
    return 200 'OK';
    add_header Content-Type text/plain;
  }

  access_log /var/log/nginx/portal-access.log;
  error_log  /var/log/nginx/portal-error.log warn;
}
