server {
  listen 80;
  server_name _;

  root /usr/share/nginx/html;
  index index.html;

  # Angular SPA
  location / {
    try_files $uri $uri/ /index.html;
  }

  # Static assets cache (evita cachear index.html)
  location ~* \.(?:css|js|png|jpg|jpeg|gif|ico|svg|woff2?)$ {
    expires 30d;
    add_header Cache-Control "public";
    try_files $uri =404;
  }

  # ---------- PROXIES (equivalentes a tu proxy.conf prod) ----------
  # Nota: usamos ^~ y NO duplicamos el bloque para "="; con $request_uri
  # funciona igual con o sin barra final y mantiene el querystring.

  # /api/v1/managers -> http://52.55.197.150/managers/api/v1/managers...
  location ^~ /api/v1/managers {
    proxy_pass http://52.55.197.150/managers$request_uri;
    include /etc/nginx/proxy_params;
  }

  # /api/v1/clients -> http://52.55.197.150/managers/api/v1/clients...
  location ^~ /api/v1/clients {
    proxy_pass http://52.55.197.150/managers$request_uri;
    include /etc/nginx/proxy_params;
  }
 # /api/v1/clients -> http://52.55.197.150/managers/api/v1/clients...
  location ^~ /api/v1/reports {
    proxy_pass http://52.55.197.150/reports$request_uri;
    include /etc/nginx/proxy_params;
  }
  # /api/v1/clients-with-manager -> http://52.55.197.150/managers/api/v1/clients-with-manager...
  location ^~ /api/v1/clients-with-manager {
    proxy_pass http://52.55.197.150/managers$request_uri;
    include /etc/nginx/proxy_params;
  }

  # /api/v1/suppliers -> http://52.55.197.150/crm/api/v1/suppliers...
  location ^~ /api/v1/suppliers {
    proxy_pass http://52.55.197.150/crm$request_uri;
    include /etc/nginx/proxy_params;
  }

  # /api/v1/products -> http://52.55.197.150/inventory/api/v1/products...
  location ^~ /api/v1/products {
    proxy_pass http://52.55.197.150/inventory$request_uri;
    include /etc/nginx/proxy_params;
  }
   # /api/v1/products -> http://52.55.197.150/inventory/api/v1/products...
  location ^~ /api/v1/products/bulk-upload {
    proxy_pass http://52.55.197.150/inventory$request_uri;
    include /etc/nginx/proxy_params;
  }

  # /api/v1/inventory -> http://52.55.197.150/inventory/api/v1/inventory...
  location ^~ /api/v1/inventory {
    proxy_pass http://52.55.197.150/inventory$request_uri;
    include /etc/nginx/proxy_params;
  }

  # /api/users-with-roles -> http://52.55.197.150/roles/api/users-with-roles...
  location ^~ /api/users-with-roles {
    proxy_pass http://52.55.197.150/roles$request_uri;
    include /etc/nginx/proxy_params;
  }

  # /api/users -> http://52.55.197.150/roles/api/users...
  location ^~ /api/users {
    proxy_pass http://52.55.197.150/roles$request_uri;
    include /etc/nginx/proxy_params;
  }

  # /auth y /auth/login -> mantener el path original contra 52.55.197.150
  location ^~ /auth {
    proxy_pass http://52.55.197.150$request_uri; # conserva /auth/... tal cual
    include /etc/nginx/proxy_params;
  }

  # Healthcheck
  location = /healthz {
    return 200 'OK';
    add_header Content-Type text/plain;
  }

}
