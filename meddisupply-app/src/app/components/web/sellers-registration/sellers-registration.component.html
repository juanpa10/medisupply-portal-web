<div class="sellers-page">
  <div class="content">
    <section class="card form-card">
  <h3>Registrar clientes</h3>
  <p class="muted">Registra clientes (Razón social y NIT). Los movimientos quedan en auditoría.</p>

      <div *ngIf="successMessage" class="alert success">{{ successMessage }}</div>
      <div *ngIf="errorMessage" class="alert error">{{ errorMessage }}</div>

      <form [formGroup]="form" (ngSubmit)="register()" class="grid">
        <div class="col">
          <label>Razón social *</label>
          <input formControlName="name" placeholder="Razón social (cliente)..." [class.invalid]="isInvalid('name')" />
          <div class="error" *ngIf="isInvalid('name')">La razón social es obligatoria.</div>

          <label>NIT *</label>
          <input formControlName="identifier" placeholder="NIT o identificador fiscal..." [class.invalid]="isInvalid('identifier')" />
          <div class="error" *ngIf="isInvalid('identifier')">El NIT es obligatorio.</div>

          <div class="actions">
            <button type="button" class="btn ghost" (click)="form.reset()">Cancelar</button>
            <button type="submit" class="inline-block bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700" [disabled]="form.invalid || loading">Registrar</button>
          </div>
        </div>
      </form>
    </section>

    <section class="card table-card">
      <div class="flex items-center justify-between">
        <h4>Clientes</h4>
        <div class="flex items-center gap-2">
          <a *ngIf="canAssignManagers" routerLink="/app/assign-manager" class="inline-block bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700">Asignar gerente</a>
          <span *ngIf="!canAssignManagers" class="text-sm text-gray-500" title="Solo los usuarios con rol 'admin' o 'security_admin' pueden asignar gerentes"> 
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
              <circle cx="12" cy="12" r="10"></circle>
              <path d="M12 8v4"></path>
              <circle cx="12" cy="17" r="1"></circle>
            </svg>
          </span>
        </div>
      </div>
      <p class="muted">Lista de clientes asociados al vendedor autenticado.</p>

      <!-- If admin views this page and there are no clients, show guidance -->
      <div *ngIf="canAssignManagers && (!clients || clients.length === 0)" class="alert info" style="margin-top:8px; padding:10px; border-radius:6px; background:#eef7ff; color:#084298;">
        <strong>Nota:</strong>
        Ingresa como Vendedor para ver tus clientes o usa la opción <a routerLink="/app/assign-manager" class="underline">Asignar gerente</a> para gestionar todos los clientes.
      </div>

      <div class="table-wrap">
        <table class="sellers-table">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>NIT</th>
              <th>Razón social</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let c of clients">
              <td>{{ c.created_at ? (c.created_at | date:'dd/MM/yyyy') : '—' }}</td>
              <td>{{ c.identifier }}</td>
              <td>{{ c.name }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </div>
</div>
